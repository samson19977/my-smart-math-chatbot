import streamlit as st
import pandas as pd
import os
import zipfile
from PIL import Image

# ğŸ¨ Page setup
st.set_page_config(page_title="Smart Math Teacher", layout="centered")

# ğŸ“ Correct image folder
ZIP_FILE = "Image_for_group_4-6.zip"
IMAGE_FOLDER = "Image_for_group_4-6"

# ğŸ”“ Extract images if not already
if not os.path.exists(IMAGE_FOLDER) and os.path.exists(ZIP_FILE):
    with zipfile.ZipFile(ZIP_FILE, 'r') as zip_ref:
        zip_ref.extractall()

# ğŸ“˜ Load the dataset
data = pd.read_excel("Dataset for 4-6 Age Group.xlsx")

# ğŸ” Session state
if 'index' not in st.session_state:
    st.session_state.index = 0
if 'show_answer' not in st.session_state:
    st.session_state.show_answer = False

# âœ¨ Styling
st.markdown("""
    <style>
    .fun-title {
        font-size: 36px;
        color: #ff3399;
        text-align: center;
        font-family: Comic Sans MS;
    }
    .question-box {
        border: 3px dashed #ffcc00;
        padding: 20px;
        border-radius: 15px;
        background-color: #fff8dc;
    }
    </style>
""", unsafe_allow_html=True)

# ğŸ‰ App title
st.markdown("<div class='fun-title'>ğŸ“ Smart Math Teacher</div>", unsafe_allow_html=True)
st.markdown("### ğŸ‘¶ Hello Little Genius! Letâ€™s play and learn some magical math! âœ¨ğŸˆ")

# ğŸ§  Main logic
if st.session_state.index < len(data):
    row = data.iloc[st.session_state.index]
    st.markdown(f"<div class='question-box'>ğŸ“ <b>Question {st.session_state.index + 1}:</b> {row['problem']}</div>", unsafe_allow_html=True)

    # ğŸ–¼ï¸ Show image if exists
    image_name = str(row['image']) if pd.notna(row['image']) else None
    if image_name:
        image_path = os.path.join(IMAGE_FOLDER, f"{image_name}.png")
        if os.path.exists(image_path):
            st.image(image_path, width=250, caption="ğŸ‘€ Count carefully and have fun!")
        else:
            st.warning(f"âŒ Oops! We couldnâ€™t find the image `{image_name}.png` ğŸ˜¢")

    # âœï¸ Answer input - always blank
    user_answer = st.text_input("ğŸ§  Type your answer here:", value="", key=f"answer_{st.session_state.index}")

    # âœ… Submit
    if st.button("ğŸ¯ Submit Answer"):
        if user_answer.strip() == str(row['answer']):
            st.balloons()
            st.success("ğŸŒŸ Bravo! You're a math superstar! ğŸ’–âœ¨ I'm *super proud* of you! ğŸ¥³ You're making numbers dance like magic! ğŸ¶ğŸ’« Keep up the amazing work, little genius! ğŸŒˆğŸ§ ")
            st.session_state.show_answer = False
        else:
            st.warning("ğŸ§ Oopsie! Thatâ€™s not quite right, but youâ€™re doing amazing! ğŸŒŸ Wanna see the correct answer and learn something new? ğŸ’¡ğŸ§  Youâ€™ve got this! ğŸ§ğŸ’¡")
            st.session_state.show_answer = True

    # ğŸ’¡ Show answer
    if st.session_state.show_answer:
        if st.button("ğŸ’¡ Show the Correct Answer"):
            st.info(f"âœ… The correct answer is: **{row['answer']}** ğŸ¯")

    # ğŸ‘‰ Next Question
    if st.button("ğŸ‘‰ Next Question"):
        st.session_state.index += 1
        st.session_state.show_answer = False
        st.rerun()

else:
    st.balloons()
    st.success("ğŸ… Wooohooo! You finished all the questions! ğŸ“ You're officially a Math Hero! ğŸ¦¸â€â™€ï¸ğŸ¦¸â€â™‚ï¸ Time to celebrate! ğŸ‰ğŸ¥³")
